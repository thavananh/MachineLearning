<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JSON Formatter</title>
    <style>
        /* Common Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            margin-top: 0;
        }
        input, button, select, textarea {
            border: 1px solid #555;
            margin: 5px 0;
            padding: 5px;
        }
        button {
            cursor: pointer;
        }
        #output {
            white-space: pre-wrap;
            padding: 10px;
            border: 1px solid #555;
            overflow: auto;
            max-height: 400px;
        }
        .string {}
        .number {}
        .boolean {}
        .null {}
        .key {}
        .brace {}
        .punctuation {}

        /* Default Dark Theme */
        body.dark {
            background-color: #1e1e1e;
            color: #c5c6c7;
        }
        body.dark h1, body.dark h2 {
            color: #dcdcdc;
        }
        body.dark input, body.dark button, body.dark select, body.dark textarea {
            background-color: #2e2e2e;
            color: #c5c6c7;
            border-color: #555;
        }
        body.dark #output {
            background-color: #2e2e2e;
            border-color: #555;
        }
        body.dark .string { color: #e6db74; }       /* Yellow */
        body.dark .number { color: #ae81ff; }       /* Purple */
        body.dark .boolean { color: #66d9ef; }      /* Cyan */
        body.dark .null { color: #fd971f; }         /* Orange */
        body.dark .key { color: #f92672; }          /* Pink */
        body.dark .brace { color: #f8f8f2; }        /* White */
        body.dark .punctuation { color: #f8f8f2; }  /* White */

        /* Solarized Dark Theme */
        body.solarized-dark {
            background-color: #002b36;
            color: #839496;
        }
        body.solarized-dark h1, body.solarized-dark h2 {
            color: #93a1a1;
        }
        body.solarized-dark input, body.solarized-dark button, body.solarized-dark select, body.solarized-dark textarea {
            background-color: #073642;
            color: #839496;
            border-color: #586e75;
        }
        body.solarized-dark #output {
            background-color: #073642;
            border-color: #586e75;
        }
        body.solarized-dark .string { color: #2aa198; }      /* Cyan */
        body.solarized-dark .number { color: #b58900; }      /* Yellow */
        body.solarized-dark .boolean { color: #268bd2; }     /* Blue */
        body.solarized-dark .null { color: #d33682; }        /* Magenta */
        body.solarized-dark .key { color: #859900; }         /* Green */
        body.solarized-dark .brace { color: #93a1a1; }       /* Light Gray */
        body.solarized-dark .punctuation { color: #93a1a1; } /* Light Gray */

        /* Dracula Theme */
        body.dracula {
            background-color: #282a36;
            color: #f8f8f2;
        }
        body.dracula h1, body.dracula h2 {
            color: #f8f8f2;
        }
        body.dracula input, body.dracula button, body.dracula select, body.dracula textarea {
            background-color: #44475a;
            color: #f8f8f2;
            border-color: #6272a4;
        }
        body.dracula #output {
            background-color: #44475a;
            border-color: #6272a4;
        }
        body.dracula .string { color: #f1fa8c; }        /* Yellow */
        body.dracula .number { color: #bd93f9; }        /* Purple */
        body.dracula .boolean { color: #8be9fd; }       /* Cyan */
        body.dracula .null { color: #ff79c6; }          /* Pink */
        body.dracula .key { color: #50fa7b; }           /* Green */
        body.dracula .brace { color: #f8f8f2; }         /* White */
        body.dracula .punctuation { color: #f8f8f2; }   /* White */

        /* Light Theme */
        body.light {
            background-color: #ffffff;
            color: #000000;
        }
        body.light h1, body.light h2 {
            color: #000000;
        }
        body.light input, body.light button, body.light select, body.light textarea {
            background-color: #f0f0f0;
            color: #000000;
            border-color: #ccc;
        }
        body.light #output {
            background-color: #f0f0f0;
            border-color: #ccc;
        }
        body.light .string { color: #008000; }       /* Green */
        body.light .number { color: #0000FF; }       /* Blue */
        body.light .boolean { color: #0000FF; }      /* Blue */
        body.light .null { color: #FF00FF; }         /* Magenta */
        body.light .key { color: #A52A2A; }          /* Brown */
        body.light .brace { color: #000000; }        /* Black */
        body.light .punctuation { color: #000000; }  /* Black */
    </style>
</head>
<body class="dark">
    <h1>JSON Formatter</h1>
    <div>
        <label>Load JSON file:</label>
        <input type="file" id="fileInput" accept=".json">
    </div>
    <div>
        <label>Fetch JSON from URL:</label>
        <input type="text" id="urlInput" placeholder="Enter URL">
        <button id="fetchBtn">Fetch</button>
    </div>
    <div>
        <label>Paste JSON here:</label><br>
        <textarea id="jsonInput" rows="10" cols="80"></textarea>
    </div>
    <div>
        <label>Indentation spaces:</label>
        <select id="indentSelect">
            <option value="2">2</option>
            <option value="4" selected>4</option>
            <option value="8">8</option>
        </select>
        <label>Theme:</label>
        <select id="themeSelect">
            <option value="dark" selected>Default Dark</option>
            <option value="solarized-dark">Solarized Dark</option>
            <option value="dracula">Dracula</option>
            <option value="light">Light</option>
        </select>
        <button id="formatBtn">Format JSON</button>
        <button id="downloadBtn">Download</button>
        <button id="clearBtn">Clear All</button>
    </div>
    <h2>Formatted JSON:</h2>
    <pre id="output"></pre>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const urlInput = document.getElementById('urlInput');
            const fetchBtn = document.getElementById('fetchBtn');
            const jsonInput = document.getElementById('jsonInput');
            const indentSelect = document.getElementById('indentSelect');
            const formatBtn = document.getElementById('formatBtn');
            const output = document.getElementById('output');
            const downloadBtn = document.getElementById('downloadBtn');
            const themeSelect = document.getElementById('themeSelect');
            const clearBtn = document.getElementById('clearBtn');
            const body = document.body;

            let jsonData = null;

            fileInput.addEventListener('change', function() {
                const file = fileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        jsonInput.value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });

            fetchBtn.addEventListener('click', function() {
                let url = urlInput.value.trim();
                if (url) {
                    // Add protocol if missing
                    if (!/^https?:\/\//i.test(url)) {
                        url = 'https://' + url;
                    }

                    fetch(url)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('HTTP error, status = ' + response.status);
                            }
                            return response.text();
                        })
                        .then(text => {
                            try {
                                jsonData = JSON.parse(text);
                                jsonInput.value = JSON.stringify(jsonData, null, 2);
                            } catch (e) {
                                alert('Error parsing JSON: ' + e.message);
                            }
                        })
                        .catch(error => {
                            console.error(error);
                            alert('Error fetching JSON: ' + error.message + '\nNote: CORS policy might block fetching this URL directly.');
                        });
                }
            });

            formatBtn.addEventListener('click', function() {
                let inputText = jsonInput.value;
                let indent = parseInt(indentSelect.value);
                try {
                    let obj = JSON.parse(inputText);
                    let formatted = JSON.stringify(obj, null, indent);
                    output.innerHTML = syntaxHighlight(formatted);
                    jsonData = obj;
                } catch (e) {
                    alert('Invalid JSON input');
                }
            });

            downloadBtn.addEventListener('click', function() {
                if (jsonData) {
                    let indent = parseInt(indentSelect.value);
                    let formatted = JSON.stringify(jsonData, null, indent);
                    let blob = new Blob([formatted], {type: "application/json"});
                    let url = URL.createObjectURL(blob);
                    let a = document.createElement('a');
                    a.href = url;
                    a.download = 'formatted.json';
                    a.click();
                    URL.revokeObjectURL(url);
                } else {
                    alert('No JSON data to download');
                }
            });

            clearBtn.addEventListener('click', function() {
                jsonInput.value = '';
                output.innerHTML = '';
                urlInput.value = '';
                fileInput.value = '';
                jsonData = null;
            });

            themeSelect.addEventListener('change', function() {
                body.className = themeSelect.value;
            });

            function syntaxHighlight(json) {
                json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return json.replace(/("(?:\\u[\da-fA-F]{4}|\\[^u]|[^\\"])*"(?:\s*:)?|true|false|null|-?\d+(?:\.\d+)?(?:[eE][+\-]?\d+)?|[{}\[\]]|[:,])/g, function (match) {
                    let cls = '';
                    if (/^"/.test(match)) {
                        if (/:$/.test(match)) {
                            cls = 'key';
                        } else {
                            cls = 'string';
                        }
                    } else if (/true|false/.test(match)) {
                        cls = 'boolean';
                    } else if (/null/.test(match)) {
                        cls = 'null';
                    } else if (/^[{}\[\]]$/.test(match)) {
                        cls = 'brace';
                    } else if (/^[:,]$/.test(match)) {
                        cls = 'punctuation';
                    } else if (/^-?\d+/.test(match)) {
                        cls = 'number';
                    }
                    return '<span class="' + cls + '">' + match + '</span>';
                });
            }

        });
    </script>
</body>
</html>
